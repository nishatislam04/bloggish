generator client {
  provider               = "prisma-client"
  output                 = "../app/generated/prisma"
  generatedFileExtension = "ts"
  importFileExtension    = "ts"
  moduleFormat           = "esm"
  engineType             = "client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  firstName     String
  lastName      String?
  username      String         @unique
  posts         Post[]
  emailVerified Boolean        @default(false)
  image         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  sessions      Session[]
  accounts      Account[]
  comments      Comment[]
  postReacts    PostReact[]
  commentReacts CommentReact[]

  @@map("user")
}

model Post {
  id        String  @id @default(cuid())
  title     String
  body      Json // For RTE content (2.1.2)
  excerpt   String? // Short description for preview
  slug      String  @unique // For SEO-friendly URLs
  shortLink String  @unique // For sharing (2.1.17)

  // Author relationship (2.1.3)
  authorId String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  // Category relationship (2.1.7)
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  // Tags relationship (2.1.6)
  tags PostTag[]

  // Comments with sub-comments support (2.1.5, 2.1.8)
  comments Comment[]

  // Reactions (2.1.9)
  reactions PostReact[]

  // Media support (2.1.13, 2.1.18)
  coverPhoto String? // URL for cover image (2.1.18)
  images     Image[] // Multiple images support (2.1.13)

  // Versioning (2.1.4)
  version Int @default(1)

  // Privacy and publishing controls (2.1.14, 2.1.15, 2.1.16)
  status      PostStatus @default(DRAFT)
  privacy     Privacy    @default(PUBLIC)
  publishedAt DateTime? // Scheduled publishing (2.1.15)
  deletedAt   DateTime? // Soft delete with scheduling (2.1.16)

  // Timestamps (2.1.11, 2.1.12)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([publishedAt])
  @@index([authorId])
  @@map("posts")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  posts       Post[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("categories")
}

model Tag {
  id        String    @id @default(cuid())
  name      String    @unique
  slug      String    @unique
  posts     PostTag[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("tags")
}

model PostTag {
  id     String @id @default(cuid())
  postId String
  tagId  String
  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag    Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([postId, tagId])
  @@map("post_tags")
}

model Comment {
  id      String @id @default(cuid())
  content String
  body    Json? // For rich text comments

  // Author relationship
  authorId String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  // Post relationship
  postId String
  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)

  // Sub-comments support (2.1.5)
  parentId String? // For replies
  parent   Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies  Comment[] @relation("CommentReplies")

  // Comment reactions (2.1.10)
  reactions CommentReact[]

  // Moderation
  status CommentStatus @default(APPROVED)

  // Timestamps (2.1.11, 2.1.12)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@index([parentId])
  @@map("comments")
}

model PostReact {
  id        String    @id @default(cuid())
  type      ReactType
  postId    String
  userId    String
  post      Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now())

  @@unique([postId, userId])
  @@map("post_reacts")
}

model CommentReact {
  id        String    @id @default(cuid())
  type      ReactType
  commentId String
  userId    String
  comment   Comment   @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now())

  @@unique([commentId, userId])
  @@map("comment_reacts")
}

model Image {
  id        String   @id @default(cuid())
  url       String
  altText   String?
  caption   String?
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@map("images")
}

model Session {
  id        String   @id @default(cuid())
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id @default(cuid())
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

enum PostStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
  ARCHIVED
}

enum Privacy {
  PUBLIC
  PRIVATE
  UNLISTED
}

enum CommentStatus {
  PENDING
  APPROVED
  REJECTED
  SPAM
}

enum ReactType {
  LIKE
  LOVE
  HAHA
  WOW
  SAD
  ANGRY
}
